# LUA文件
`demo_without_CV_new_version.lua`文件用于在视觉模块还没接入时在SITL上模拟使用的脚本，在代码文件的第10行的`itargetloc = {}`内存储了靶标的坐标，模拟时可以修改。\
`demo_to_test_new_version.lua`是用于投弹实测的脚本文件。\
`demo_new_version.lua`是完整版的脚本文件。\
`mission_choose_load.lua`用于航点文件加载
# 误差分析
## 见文件投弹误差分析
# 与飞控的对接情况
## 飞控与脚本的通话步骤
0.将航线文件上传到飞控的主目录\
1.将`TARGET_NUM`改为航线文件的号码\
2.将`TARGET_GET`改为1\
3.检测到`TARGET_AUTO`由0变为1，择机将模式切为AUTO\
后续由脚本进行控制，变量的详细信息见下
## 在ArduPilot中创建相关的变量
注意：每次测试前都要重置变量\
`TARGET_GET = 0`靶标数据未获得为0(默认值)，数据已获得为1\
`TARGET_WAYPOINT = 0`未到最后航点为0(默认值)，已到最后航点为1\
`TARGET_NUM = 0`所选择的航线号码\
`TARGET_REMEDY = 0`首次投弹时值为0，首次投弹失败值为1，第二次投弹失败值为2\
`TARGET_AUTO = 0`\默认值为0，航点上传完成，值由0变为1\
投弹完成后，脚本将`TARGET_GET`和`TARGET_WAYPOINT`改回0。
## GPS与AHRS定位问题
飞控的AHRS系统默认引入了EKF滤波算法。\
在飞控的AHRS相关参数，可以调整AHRS对GPS和陀螺仪、空速管、气压计等设施的采用方案。\
在飞控的EKF3相关参数有非常多的参数可以研究调整。
## 航线信息接口（需要上飞控测试）
飞控将接受靶标号码并载入航线文件，然后将模式切换为auto（待测试）。\
航线更改后将信息发送到`wait_for_waypoint_change()`供脚本确认。\
## 投弹决策与脚本刷新率
设置当计算得投弹落点与标靶距离小于3米时进行投弹操作，且每隔100ms进行一次投弹计算（刷新率），误差范围为10m。（待测试）\
## 航线选择脚本
等待对接投弹航线和补救航线最后一个WAYPOINT的接口。
## 测试准备
设计一个文档记录测试的具体步骤。\
确定实验需要记录的数据。\
确定可以修改与改进的因素。
